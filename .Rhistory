df.files$year[id.ssp1[i]], " (",
df.files$ssp[id.ssp1[i]], ", ",
df.files$GCM[id.ssp1[i]], ")"),
cex.main = 0.5)
}
par(mfrow = c(4, 7))
for(i in seq_along(id.ssp1)){
plot(snakes.ssp1[[i]], main = paste0(df.files$species[id.ssp1[i]],": ",
df.files$year[id.ssp1[i]], " (",
df.files$ssp[id.ssp1[i]], ", ",
df.files$GCM[id.ssp1[i]], ")"),
cex.main = 0.5)
}
84/7
curve(x*(1-x), 0, 1)
curve(x*(1-x), 0, 1, xlab = "N", ylab = "dN/dt")
curve(x*(1-x), 0, 1, xlab = "N", ylab = "dN/dt", col = "red")
knitr::opts_chunk$set(echo = TRUE)
library(raster)
lc <- readRDS("Data-objects/Incidence models data-Apr2020.rds")
head(lc)
library(ggplot2)
ggplot(lc) + geom_tile(aes(x = x, y = y, fill = land.cover)) +
coord_fixed()
ggplot(lc) + geom_tile(aes(x = x, y = y, fill = as.factor(land.cover))) +
coord_fixed()
lc <- readRDS("Data-objects/Incidence models data-Apr2020.rds")
ggplot(lc) + geom_tile(aes(x = x, y = y, fill = as.factor(land.cover))) +
coord_fixed() +
labs(fill = "Land cover")
head(lc)
tc <- readRDS("Data-objects/Snakes-env-data.rds")
head(tc)
lc <- readRDS("Data-objects/Snakes-env-data.rds")
ggplot(lc) + geom_tile(aes(x = x, y = y, fill = as.factor(land.cover))) +
coord_fixed() +
labs(fill = "Land cover")
ggplot(lc) + geom_tile(aes(x = x, y = y, fill = tree)) +
coord_fixed() +
labs(fill = "Tree cover")
ggplot(lc) + geom_tile(aes(x = x, y = y, fill = tree)) +
coord_fixed() +
labs(fill = "Tree cover")
tc.r <- rasterFromCells(lc[, c("x", "y", "tree")])
tc.r <- rasterFromCells(lc[, c("x", "y", "tree")])
head(lc)
lc <- readRDS("Data-objects/Snakes-env-data.rds")
lc.r <- rasterFromCells(lc[, c("x", "y", "land.cover")])
head(lc[, c("x", "y", "land.cover")])
lc.r <- rasterFromXYZ(lc[, c("x", "y", "land.cover")])
plot(lc.r)
knitr::opts_chunk$set(echo = TRUE)
library(raster); library(ggplot2);library(reshape); library(foreach); library(data.table)
incid.data <- readRDS("Data-objects/Incidence models data-Apr2020.rds")
proj.files <- list.files("Incidence-projections", "rds", full.names = T)
projections <- lapply(proj.files, readRDS)
scenarios <- substr(proj.files, 34, nchar(proj.files) - 4)
med.projs <- lapply(projections, function(x){
d <- foreach(i = seq_along(x), .combine = rbind) %do% {colMeans(x[[i]])}
d <- data.frame(d)
d$year <- 2010:2050
return(d)
})
med.projs <- lapply(seq_along(med.projs),
function(x){
med.projs[[x]]$scenario <- scenarios[x]
return(med.projs[[x]])
})
med.projs.df <- rbindlist(med.projs)
med.projs.df$scen <- med.projs.df$scenario
library(ggplot2)
env.time <-  ggplot(med.projs.df) +
geom_ribbon(aes(x = year, ymin = env.025, ymax = env.97, fill = scen), alpha = 0.05) +
geom_point(aes(x = year, y = env.med, colour = scen), size = 0.25) +
geom_line(aes(x = year, y = env.med, colour = scen), size = 0.25, linetype = "dotted") +
geom_hline(yintercept = mean(incid.data$envenomings), colour = "grey50", linetype = "dashed") +
geom_smooth(aes(x = year, y = env.med, colour = scen, fill = scen), alpha = 0.2, size = 0.75, method = "lm") +
labs(x = "Year", y = "Envenoming incidence", colour = "Scenario", fill = "Scenario") +
theme_light() +
theme(axis.text.x = element_text(angle = 45, vjust = 0.7))
env.time
decline.model <- lm(env.med ~ 0 + scen + scen : year, data = med.projs.df)
sum.mod <- summary(decline.model)
rates <- data.frame(sum.mod$coefficients)
rates.df <- rates[8:14,]
rates.df$proj <- c("SSP1",
"SSP2 CNRM-CM5", "SSP2 GFDL-CM3", "SSP2 MPI-ESM-LR",
"SSP5 CNRM-CM5", "SSP5 GFDL-CM3", "SSP5 MPI-ESM-LR")
rates.df$signif <- as.factor(ifelse(rates.df$Pr...t.. > 0.05, 0, 1))
rates.df$SSP <- as.factor(substr(rates.df$proj, 1, 4))
rates.plot <- ggplot(rates.df) + geom_boxplot(aes(x = 1, y = Estimate)) +
geom_point(aes(x = 1, y = Estimate, colour = proj, shape = signif ), size = 3, position = position_dodge(0.3))+
scale_shape_manual(values = c(4, 20)) +
geom_linerange(aes(x = 1, ymin = Estimate - Std..Error, ymax = Estimate + Std..Error, colour = proj), position = position_dodge(0.3)) +
labs(colour = "Scenario", y = "Absolute incidence change per year",
x = "") +
theme(axis.text.x = element_text(size = 0),
legend.position = "none")
rates.plot
med.projs.df$year[1]
scen <- levels(as.factor(med.projs.df$scen))
new.data.2050 <- expand.grid(scen = scen, year = 2050)
new.data.2010 <- expand.grid(scen = scen, year = 2010)
preds.2050 <- predict(decline.model, newdata = new.data.2050)
preds.2010 <- predict(decline.model, newdata = new.data.2010)
Percent.decline <- (preds.2010-preds.2050)/mean(incid.data$envenomings) * 100
Percent.decline
rates.df$Percent.decline <- Percent.decline * (-1)
library(doParallel)
registerDoParallel(cores = 24)
library(doParallel)
library(terra)
registerDoParallel(cores = 24)
ssp <- c("SSP2", "SSP5")
rcp <- c("RCP 4.5", "RCP 8.5")
gcm <- c("CNRM-CM5", "GFDL-CM3", "MPI-ESM-LR")
spp <- c("Bungarus caeruleus", "Bungarus ceylonicus",
"Daboia russelii", "Echis carinatus",
"Hypnale spp", "Naja naja",
"Trimeresurus trigonocephalus")
data <- expand.grid(ssp, rcp, gcm, spp)
data
spp <- c("Bungarus caeruleus", "Bungarus ceylonicus",
"Daboia russelii", "Echis carinatus",
"Hypnale spp", "Naja naja",
"Trimeresurus trigonocephalus")
rcp <- c("RCP 4.5", "RCP 8.5")
gcm <- c("CNRM-CM5", "GFDL-CM3", "MPI-ESM-LR")
spp <- c("Bungarus caeruleus", "Bungarus ceylonicus",
"Daboia russelii", "Echis carinatus",
"Hypnale spp", "Naja naja",
"Trimeresurus trigonocephalus")
data <- expand.grid(rcp, gcm, spp)
data
i = 1
f <- paste0(rcp[i], "/",
gcm[i], "/",
2006:2010, "/"
spp[i]
data <- expand.grid(rcp, gcm, spp)
data
i
with(data, {
f <- paste0(rcp[i], "/",
gcm[i], "/",
2006:2010, "/"
spp[i]
with(data, {
f <- paste0(rcp[i], "/",
gcm[i], "/",
2006:2010, "/",
spp[i]
)
})
f
f <- paste0(data$rcp[i], "/",
data$gcm[i], "/",
2006:2010, "/",
data$spp[i])
f
data$rcp
head(data)
data <- expand.grid(rcp = rcp,
gcm = gcm,
spp = spp)
f <- paste0(data$rcp[i], "/",
data$gcm[i], "/",
2006:2010, "/",
data$spp[i])
f
f <- paste0(data$rcp[i], "/",
data$gcm[i], "/",
2006:2050, "/",
data$spp[i])
f
r <- rast(f)
f <- paste0(data$rcp[i], "/",
data$gcm[i], "/",
2006:2050, "/",
data$spp[i], ".tif")
r <- rast(f)
f <- paste0("Snake-DNCs/",
data$rcp[i], "/",
data$gcm[i], "/",
2006:2050, "/",
data$spp[i], ".tif")
r <- rast(f)
mean(r)
global(r, fun = mean)
plot(r)
global(r, fun = "mean")
global(r, function(x){mean(x)})
global(r, function(x){median(x)})
mean(r[[1]])
global(r, function(x){mean(x, na.rm = T)})
m <- global(r, function(x){median(x, na.rm = T)})
m
iqr.1 <- global(r, function(x){quantile(x, 0.25, na.rm = T)})
iqr.2 <- global(r, function(x){quantile(x, 0.75, na.rm = T)})
iqr.1
iqr.2
df <- data.frame(spp = spp[i],
Median = m,
IQ.25 = iqr.1,
IQ.75 = iqr.2,
year = 2006:2050)
df
DNCs <- foreach(i = 1:nrow(data), .combine = rbind) %dopar% {
f <- paste0("Snake-DNCs/",
data$rcp[i], "/",
data$gcm[i], "/",
2006:2050, "/",
data$spp[i], ".tif")
r <- rast(f)
m <- global(r, function(x){median(x, na.rm = T)})
iqr.1 <- global(r, function(x){quantile(x, 0.25, na.rm = T)})
iqr.2 <- global(r, function(x){quantile(x, 0.75, na.rm = T)})
df <- data.frame(spp = spp[i],
Median = m,
IQ.25 = iqr.1,
IQ.75 = iqr.2,
year = 2006:2050)
return(df)
}
DNCs
library(ggplot2)
DNCs <- foreach(i = 1:nrow(data), .combine = rbind) %dopar% {
f <- paste0("Snake-DNCs/",
data$rcp[i], "/",
data$gcm[i], "/",
2006:2050, "/",
data$spp[i], ".tif")
r <- rast(f)
m <- global(r, function(x){median(x, na.rm = T)})
iqr.1 <- global(r, function(x){quantile(x, 0.25, na.rm = T)})
iqr.2 <- global(r, function(x){quantile(x, 0.75, na.rm = T)})
df <- data.frame(spp = data$spp[i],
rcp = data$rcp[i],
gcm = data$gcm[i],
Median = m,
IQ.25 = iqr.1,
IQ.75 = iqr.2,
year = 2006:2050)
return(df)
}
ggplot(DNCs) + geom_line(aes(x = year, y = Median, colour = gcm, linetype = rcp)) +
facet_wrap(~spp)
DNCs <- data.frame(DNCs)
ggplot(DNCs) + geom_line(aes(x = year, y = Median, colour = gcm, linetype = rcp)) +
facet_wrap(~spp)
names(DNCs)
ggplot(DNCs) + geom_line(aes(x = year, y = global, colour = gcm, linetype = rcp)) +
facet_wrap(~spp)
ggplot(DNCs) + geom_smooth(aes(x = year, y = global, colour = gcm, linetype = rcp)) +
facet_wrap(~spp)
ggplot(DNCs) + geom_smooth(aes(x = year, y = global, colour = gcm, linetype = rcp, fill = gcm), method = "lm", alpha = 0.3) +
facet_wrap(~spp)
ggplot(DNCs) + geom_smooth(aes(x = year, y = global, colour = gcm,
linetype = rcp, fill = gcm),
method = "lm", alpha = 0.1) +
facet_wrap(~spp)
names(DNCs)
ggplot(DNCs) + geom_line(aes(x = year, y = global, colour = gcm,
linetype = rcp, fill = gcm)) +
geom_ribbon(aes(x = year, ymin = "X25.", ymax = "X75.", fill = gcm), alpha = 0.2) +
facet_wrap(~spp)
ggplot(DNCs) + geom_line(aes(x = year, y = global, colour = gcm,
linetype = rcp, fill = gcm)) +
geom_ribbon(aes(x = year, ymin = "X25.", ymax = "X75."), alpha = 0.2) +
facet_wrap(~spp)
ggplot(DNCs) + geom_line(aes(x = year, y = global, colour = gcm,
linetype = rcp)) +
geom_ribbon(aes(x = year, ymin = "X25.", ymax = "X75.", fill = gcm), alpha = 0.2) +
facet_wrap(~spp)
ggplot(DNCs) + geom_line(aes(x = year, y = global, colour = gcm,
linetype = rcp)) +
geom_ribbon(aes(x = year, ymin = "X25.", ymax = "X75.", fill = gcm, linetype = rcp), alpha = 0.2) +
facet_wrap(~spp)
ggplot(DNCs) + geom_point(aes(x = year, y = global, colour = gcm,
linetype = rcp, fill = gcm))
ggplot(DNCs) + geom_point(aes(x = year, y = global, colour = gcm,
linetype = rcp, fill = gcm)) +
facet_wrap(~spp)
ggplot(DNCs) + geom_point(aes(x = year, y = log10(global), colour = gcm,
linetype = rcp, fill = gcm)) +
facet_wrap(~spp)
ggplot(DNCs) + geom_point(aes(x = year, y = log10(global), colour = gcm,
pointype = rcp), size = 0.5) +
geom_smooth(aes(x = year, y = log10(global), colour = gcm, linetype = rcp, fill = gcm), alpha = 0.2) +
facet_wrap(~spp)
ggplot(DNCs) + geom_point(aes(x = year, y = log10(global), colour = gcm,
shape = rcp), size = 0.5) +
geom_smooth(aes(x = year, y = log10(global), colour = gcm, linetype = rcp, fill = gcm), alpha = 0.2) +
facet_wrap(~spp)
ggplot(DNCs) + geom_point(aes(x = year, y = log10(global), colour = gcm,
shape = rcp), size = 0.7) +
geom_smooth(aes(x = year, y = log10(global), colour = gcm, linetype = rcp, fill = gcm), alpha = 0.2) +
facet_wrap(~spp)
pdf("Plots/DNC-snakes.pdf", width = 8, height = 8)
geom_ribbon(aes(x = year, ymin = "X25.", ymax = "X75.", fill = gcm), alpha = .0)
dev.off()
pdf("Plots/DNC-snakes.pdf", width = 8, height = 8)
ggplot(DNCs) + geom_point(aes(x = year, y = log10(global), colour = gcm,
shape = rcp), size = 0.7) +
geom_smooth(aes(x = year, y = log10(global), colour = gcm, linetype = rcp, fill = gcm), alpha = 0.2) +
facet_wrap(~spp)
dev.off()
names(DNCs)
names(DNCs)[4] <- c("Median")
pdf("Plots/DNC-snakes.pdf", width = 8, height = 8)
ggplot(DNCs) + geom_point(aes(x = year, y = log10(Median), colour = gcm,
shape = rcp), size = 0.7) +
geom_smooth(aes(x = year, y = log10(Median), colour = gcm, linetype = rcp, fill = gcm), alpha = 0.2) +
facet_wrap(~spp)
dev.off()
knitr::opts_chunk$set(echo = TRUE)
lc <- readRDS("Data-objects/Snakes-env-data.rds")
library(raster)
lc.r <- rasterFromXYZ(lc[, c("x", "y", "land.cover")])
plot(lc.r)
knitr::opts_chunk$set(echo = TRUE)
lc <- readRDS("Data-objects/Snakes-env-data.rds")
library(raster)
lc.r <- rasterFromXYZ(lc[, c("x", "y", "land.cover")])
plot(lc.r)
tc.r <- rasterFromXYZ(lc[, c("x", "y", "tree")])
plot(tc.r)
popn <- raster("pop_2010.asc")
plot(popn)
dem <- raster("LKA-dem-WGS84-1km.tif")
dem <- projectRaster(dem, crs = CRS(proj4string(popn)))
plot(dem)
sn.files <- list.files("Snakes", "tif", recursive = T, full.names = T)
df.files.1 <- expand.grid(species = c("B. caeruleus", "B. ceylonicus", "D. russelli", "E. carinatus", "H. spp", "N. naja", "T. trigonocephalus"), year = 2010:2050, GCM = c(""), ssp = c("SSP1"))
df.files.25 <- expand.grid(species = c("B. caeruleus", "B. ceylonicus", "D. russelli", "E. carinatus", "H. spp", "N. naja", "T. trigonocephalus"), year = 2010:2050, GCM = c("CNRM-CM5", "GFDL-CM3", "MPI-ESM-LR"), ssp = c("SSP2", "SSP5"))
df.files <- rbind(df.files.1, df.files.25)
id.ssp1 <- which(df.files$ssp == "SSP1" & df.files$year %in% c(2010, 2024, 2037, 2050))
id.ssp2 <- which(df.files$ssp == "SSP2" & df.files$year %in% c(2010, 2024, 2037, 2050))
id.ssp5 <- which(df.files$ssp == "SSP5" & df.files$year %in% c(2010, 2024, 2037, 2050))
snakes.ssp1 <- lapply(sn.files[id.ssp1], raster)
snakes.ssp2 <- lapply(sn.files[id.ssp2], raster)
snakes.ssp5 <- lapply(sn.files[id.ssp5], raster)
par(mfrow = c(4, 7))
for(i in seq_along(id.ssp1)){
plot(snakes.ssp1[[i]], main = paste0(df.files$species[id.ssp1[i]],": ",
df.files$year[id.ssp1[i]], " (",
df.files$ssp[id.ssp1[i]], ", ",
df.files$GCM[id.ssp1[i]], ")"),
cex.main = 0.5)
}
class(snakes.ssp1)
class(snakes.ssp1[[1]])
par(mfrow = c(4, 7), bty = "n")
for(i in seq_along(id.ssp1)){
plot(snakes.ssp1[[i]], main = paste0(df.files$species[id.ssp1[i]],": ",
df.files$year[id.ssp1[i]], " (",
df.files$ssp[id.ssp1[i]], ", ",
df.files$GCM[id.ssp1[i]], ")"),
cex.main = 0.5,
legend.only=TRUE)
}
par(mfrow = c(4, 7), bty = "n")
for(i in seq_along(id.ssp1)){
plot(snakes.ssp1[[i]], main = paste0(df.files$species[id.ssp1[i]],": ",
df.files$year[id.ssp1[i]], " (",
df.files$ssp[id.ssp1[i]], ", ",
df.files$GCM[id.ssp1[i]], ")"),
cex.main = 0.5)
}
par(mfrow = c(4, 7), bty = "o")
for(i in seq_along(id.ssp1)){
plot(snakes.ssp1[[i]], main = paste0(df.files$species[id.ssp1[i]],": ",
df.files$year[id.ssp1[i]], " (",
df.files$ssp[id.ssp1[i]], ", ",
df.files$GCM[id.ssp1[i]], ")"),
cex.main = 0.5)
}
par(mfrow = c(4, 7), bty = "o")
for(i in seq_along(id.ssp1)){
plot(snakes.ssp1[[i]], main = paste0(df.files$species[id.ssp1[i]],": ",
df.files$year[id.ssp1[i]], " (",
df.files$ssp[id.ssp1[i]], ", ",
df.files$GCM[id.ssp1[i]], ")"),
cex.main = 0.5,
axis = F)
}
par(mfrow = c(4, 7), bty = "o")
for(i in seq_along(id.ssp1)){
plot(snakes.ssp1[[i]], main = paste0(df.files$species[id.ssp1[i]],": ",
df.files$year[id.ssp1[i]], " (",
df.files$ssp[id.ssp1[i]], ", ",
df.files$GCM[id.ssp1[i]], ")"),
cex.main = 0.5,
axis = F, ticks = F)
}
par(mfrow = c(4, 7), bty = "o")
for(i in seq_along(id.ssp1)){
plot(snakes.ssp1[[i]], main = paste0(df.files$species[id.ssp1[i]],": ",
df.files$year[id.ssp1[i]], " (",
df.files$ssp[id.ssp1[i]], ", ",
df.files$GCM[id.ssp1[i]], ")"),
cex.main = 0.5,
axes = F)
}
par(mfrow = c(4, 7), bty = "o", mar = c(2,2,2,2))
for(i in seq_along(id.ssp1)){
plot(snakes.ssp1[[i]], main = paste0(df.files$species[id.ssp1[i]],": ",
df.files$year[id.ssp1[i]], " (",
df.files$ssp[id.ssp1[i]], ", ",
df.files$GCM[id.ssp1[i]], ")"),
cex.main = 0.5,
axes = F,
axis = F)
}
par(mfrow = c(4, 7), bty = "o", mar = c(2,2,2,2))
for(i in seq_along(id.ssp1)){
plot(snakes.ssp1[[i]], main = paste0(df.files$species[id.ssp1[i]],": ",
df.files$year[id.ssp1[i]], " (",
df.files$ssp[id.ssp1[i]], ", ",
df.files$GCM[id.ssp1[i]], ")"),
cex.main = 0.5,
axes = F,
axis = F,
legend.width = 0)
}
par(mfrow = c(4, 7), bty = "o", mar = c(2,2,2,2))
for(i in seq_along(id.ssp1)){
plot(snakes.ssp1[[i]], main = paste0(df.files$species[id.ssp1[i]],": ",
df.files$year[id.ssp1[i]], " (",
df.files$ssp[id.ssp1[i]], ", ",
df.files$GCM[id.ssp1[i]], ")"),
cex.main = 0.5,
axes = F,
axis = F)
}
par(mfrow = c(4, 7), bty = "o", mar = c(2,2,2,2))
for(i in seq_along(id.ssp1)){
plot(snakes.ssp1[[i]], main = paste0(df.files$species[id.ssp1[i]],": ",
df.files$year[id.ssp1[i]], " (",
df.files$ssp[id.ssp1[i]], ", ",
df.files$GCM[id.ssp1[i]], ")"),
cex.main = 0.7,
axes = F,
axis = F)
}
par(mfrow = c(4, 7), bty = "o", mar = c(2,2,2,2))
for(i in seq_along(id.ssp1)){
plot(snakes.ssp1[[i]], main = paste0(df.files$species[id.ssp1[i]],": ",
df.files$year[id.ssp1[i]], " (",
df.files$ssp[id.ssp1[i]], ", ",
df.files$GCM[id.ssp1[i]], ")"),
cex.main = 0.7,
axes = F,
axis = F,
legend = F)
}
par(mfrow = c(4, 7), bty = "n", mar = c(2,2,2,2))
for(i in seq_along(id.ssp1)){
plot(snakes.ssp1[[i]], main = paste0(df.files$species[id.ssp1[i]],": ",
df.files$year[id.ssp1[i]], " (",
df.files$ssp[id.ssp1[i]], ", ",
df.files$GCM[id.ssp1[i]], ")"),
cex.main = 0.7,
axes = F,
axis = F,
legend = F)
}
par(mfrow = c(4, 7), bty = "n", mar = c(2,2,2,2))
for(i in seq_along(id.ssp1)){
plot(snakes.ssp2[[i]], main = paste0(df.files$species[id.ssp2[i]],": ",
df.files$year[id.ssp2[i]], " (",
df.files$ssp[id.ssp2[i]], ", ",
df.files$GCM[id.ssp2[i]], ")"),
cex.main = 0.7,
axes = F,
axis = F,
legend = F)
}
par(mfrow = c(4, 7), bty = "n", mar = c(2,2,2,2))
for(i in seq_along(id.ssp5)){
plot(snakes.ssp5[[i]], main = paste0(df.files$species[id.ssp5[i]],": ",
df.files$year[id.ssp5[i]], " (",
df.files$ssp[id.ssp5[i]], ", ",
df.files$GCM[id.ssp5[i]], ")"),
cex.main = 0.7,
axes = F,
axis = F,
legend = F)
}
seq_along(id.ssp5)
par(mfrow = c(4, 7), bty = "n", mar = c(2,2,2,2))
for(i in seq_along(id.ssp2)){
plot(snakes.ssp2[[i]], main = paste0(df.files$species[id.ssp2[i]],": ",
df.files$year[id.ssp2[i]], " (",
df.files$ssp[id.ssp2[i]], ", ",
df.files$GCM[id.ssp2[i]], ")"),
cex.main = 0.7,
axes = F,
axis = F,
legend = F)
}
par(mfrow = c(4, 7), bty = "n", mar = c(2,2,2,2))
for(i in seq_along(id.ssp5)){
plot(snakes.ssp5[[i]], main = paste0(df.files$species[id.ssp5[i]],": ",
df.files$year[id.ssp5[i]], " (",
df.files$ssp[id.ssp5[i]], ", ",
df.files$GCM[id.ssp5[i]], ")"),
cex.main = 0.7,
axes = F,
axis = F,
legend = F)
}
